#################################################################################################################
#GECON
#ÁREA:CRÉDITO
#PLANILHA ABERTURA DAS CONCESSÕES DE CRÉDITO
#Marcelo Vilas Boas de Castro
#DATA:10-11-2020
#################################################################################################################

#PACOTES REQUERIDOS:
#INSTALAR QUANDO NECESSÁRIO
#EXEMPLO:install.packages("pryr")
library(RCurl)
library(XML)
library(rio)

#DEFINIR PASTAS DE RESULTADOS:
getwd()
setwd("C:\\Users\\User\\Documents")

#Criando função para coleta de séries
coleta_dados_sgs = function(series,datainicial="01/03/2011", datafinal = format(Sys.time(), "%d/%m/%Y")){
  #Argumentos: vetor de séries, datainicial que pode ser manualmente alterada e datafinal que automaticamente usa a data de hoje
  #Cria estrutura de repetição para percorrer vetor com códigos de séries e depois juntar todas em um único dataframe
  for (i in 1:length(series)){
    dados = read.csv(url(paste("http://api.bcb.gov.br/dados/serie/bcdata.sgs.",series[i],"/dados?formato=csv&dataInicial=",datainicial,"&dataFinal=",datafinal,sep="")),sep=";")
    dados[,-1] = as.numeric(gsub(",",".",dados[,-1])) #As colunas do dataframe em objetos numéricos exceto a da data
    nome_coluna = series[i] #Nomeia cada coluna do dataframe com o código da série
    colnames(dados) = c('data', nome_coluna)
    nome_arquivo = paste("dados", i, sep = "") #Nomeia os vários arquivos intermediários que são criados com cada série
    assign(nome_arquivo, dados)
    
    if(i==1)
      base = dados1 #Primeira repetição cria o dataframe
    else
      base = merge(base, dados, by = "data", all = T) #Demais repetições agregam colunas ao dataframe criado
    print(paste(i, length(series), sep = '/')) #Printa o progresso da repetição
  }
  
  base$data = as.Date(base$data, "%d/%m/%Y") #Transforma coluna de data no formato de data
  base = base[order(base$data),] #Ordena o dataframe de acordo com a data
  return(base)
}

#1)Todas as séries
#cada categoria em uma linha diferente
series=c(20631, 20632, 20633,
        20634, 20635, 28163, 28164, 20636, 20637, 20638, 20639, 20640, 20641, 20642, 20643, 20644, 20645, 20646, 20647, 20648, 20649, 20650, 20651, 20652, 20653, 20654, 20655, 20656, 20657, 20658, 20659, 20660, 20661, 20662, 20663, 20664, 20665, 20666, 20667, 20668, 20669, 20670, 20671, 20672, 20673, 20674, 20675, 20676, 20677, 20678, 20679, 20680, 20681, 20682, 20683, 20684,
        20685, 20686, 20687, 20688, 20689, 20690, 20691, 20692, 20693, 20694, 20695, 20696, 20697, 20698, 20699, 20700, 20701, 20702, 20703, 20704, 20705, 20706, 20707, 20708, 20709, 20710, 20712, 20713)


base1 <- coleta_dados_sgs(series)

names(base1)=c("Data","Concessões - Total", "Concessões - Pessoas jurídicas - Total", "Concessões - Pessoas físicas - Total", 
               "Concessões - Total - Recursos livres", "Concessões - Pessoas jurídicas - Total - Recursos livres", "Concessões - Pessoas jurídicas - Não rotativo - Recursos livres", "Concessões - Pessoas jurídicas - Rotativo - Recursos livres", "Concessões - Pessoas jurídicas - Desconto de duplicatas e recebíveis - Recursos livres", "Concessões - Pessoas jurídicas - Desconto de cheques - Recursos livres", "Concessões - Pessoas jurídicas - Antecipação de faturas de cartão de crédito - Recursos livres", "Concessões - Pessoas jurídicas - Capital de giro com prazo de até 365 dias - Recursos livres", "Concessões - Pessoas jurídicas - Capital de giro com prazo superior a 365 dias - Recursos livres", "Concessões - Pessoas jurídicas - Capital de giro rotativo - Recursos livres", "Concessões - Pessoas jurídicas - Capital de giro total - Recursos livres", "Concessões - Pessoas jurídicas - Conta garantida - Recursos livres", "Concessões - Pessoas jurídicas - Cheque especial - Recursos livres", "Concessões - Pessoas jurídicas - Aquisição de veículos - Recursos livres", "Concessões - Pessoas jurídicas - Aquisição de outros bens - Recursos livres", "Concessões - Pessoas jurídicas - Aquisição de bens total - Recursos livres", "Concessões - Pessoas jurídicas - Arrendamento mercantil de veículos - Recursos livres", "Concessões - Pessoas jurídicas - Arrendamento mercantil de outros bens - Recursos livres", "Concessões - Pessoas jurídicas - Arrendamento mercantil total - Recursos livres", "Concessões - Pessoas jurídicas - Vendor - Recursos livres", "Concessões - Pessoas jurídicas - Compror - Recursos livres", "Concessões - Pessoas jurídicas - Cartão de crédito rotativo - Recursos livres", "Concessões - Pessoas jurídicas - Cartão de crédito parcelado - Recursos livres", "Concessões - Pessoas jurídicas - Cartão de crédito à vista - Recursos livres",
               "Concessões - Pessoas jurídicas - Cartão de crédito total - Recursos livres", "Concessões - Pessoas jurídicas - Adiantamento sobre contratos de câmbio (ACC) - Recursos livres", "Concessões - Pessoas jurídicas - Financiamento a importações - Recursos livres", "Concessões - Pessoas jurídicas - Financiamento a exportações - Recursos livres", "Concessões - Pessoas jurídicas - Repasse externo - Recursos livres", "Concessões - Pessoas jurídicas - Outros créditos livres - Recursos livres", "Concessões - Pessoas físicas - Total - Recursos livres", "Concessões - Pessoas físicas - Não rotativo - Recursos livres", "Concessões - Pessoas físicas - Rotativo - Recursos livres", "Concessões - Pessoas físicas - Cheque especial - Recursos livres", "Concessões - Pessoas físicas - Crédito pessoal não consignado - Recursos livres", "Concessões - Pessoas físicas - Crédito pessoal não consignado vinculado à composição de dívidas - Recursos livres", "Concessões - Pessoas físicas - Crédito pessoal consignado para trabalhadores do setor privado - Recursos livres", "Concessões - Pessoas físicas - Crédito pessoal consignado para trabalhadores do setor público - Recursos livres", "Concessões - Pessoas físicas - Crédito pessoal consignado para aposentados e pensionistas do INSS - Recursos livres", "Concessões - Pessoas físicas - Crédito pessoal consignado total - Recursos livres", "Concessões - Pessoas físicas - Crédito pessoal total - Recursos livres", "Concessões - Pessoas físicas - Aquisição de veículos - Recursos livres", "Concessões - Pessoas físicas - Aquisição de outros bens - Recursos livres", "Concessões - Pessoas físicas - Aquisição de bens total - Recursos livres", "Concessões - Pessoas físicas - Arrendamento mercantil de veículos - Recursos livres", "Concessões - Pessoas físicas - Arrendamento mercantil de outros bens - Recursos livres", "Concessões - Pessoas físicas - Arrendamento mercantil total - Recursos livres", "Concessões - Pessoas físicas - Cartão de crédito rotativo - Recursos livres", "Concessões - Pessoas físicas - Cartão de crédito parcelado - Recursos livres", "Concessões - Pessoas físicas - Cartão de crédito à vista - Recursos livres", "Concessões - Pessoas físicas - Cartão de crédito total - Recursos livres", "Concessões - Pessoas físicas - Desconto de cheques - Recursos livres", "Concessões - Pessoas físicas - Outros créditos livres - Recursos livres", 
               "Concessões - Total - Recursos direcionados", "Concessões - Pessoas jurídicas - Total - Recursos direcionados", "Concessões - Pessoas jurídicas - Crédito rural com taxas de mercado - Recursos direcionados", "Concessões - Pessoas jurídicas - Crédito rural com taxas reguladas - Recursos direcionados", "Concessões - Pessoas jurídicas - Crédito rural total - Recursos direcionados", "Concessões - Pessoas jurídicas - Financiamento imobiliário com taxas de mercado - Recursos direcionados", "Concessões - Pessoas jurídicas - Financiamento imobiliário com taxas reguladas - Recursos direcionados", "Concessões - Pessoas jurídicas - Financiamento imobiliário total - Recursos direcionados", "Concessões - Pessoas jurídicas - Capital de giro com recursos do BNDES - Recursos direcionados", "Concessões - Pessoas jurídicas - Financiamento de investimentos com recursos do BNDES - Recursos direcionados", "Concessões - Pessoas jurídicas - Financiamento agroindustrial com recursos do BNDES - Recursos direcionados", "Concessões - Pessoas jurídicas - Financiamento com recursos do BNDES total - Recursos direcionados", "Concessões - Pessoas jurídicas - Outros créditos direcionados - Recursos direcionados", "Concessões - Pessoas físicas - Total - Recursos direcionados", "Concessões - Pessoas físicas - Crédito rural com taxas de mercado - Recursos direcionados", "Concessões - Pessoas físicas - Crédito rural com taxas reguladas - Recursos direcionados", "Concessões - Pessoas físicas - Crédito rural total - Recursos direcionados", "Concessões - Pessoas físicas - Financiamento imobiliário com taxas de mercado - Recursos direcionados", "Concessões - Pessoas físicas - Financiamento imobiliário com taxas reguladas - Recursos direcionados", "Concessões - Pessoas físicas - Financiamento imobiliário total - Recursos direcionados", "Concessões - Pessoas físicas - Capital de giro com recursos do BNDES - Recursos direcionados", "Concessões - Pessoas físicas - Financiamento de investimentos com recursos do BNDES - Recursos direcionados", "Concessões - Pessoas físicas - Financiamento agroindustrial com recursos do BNDES - Recursos direcionados", "Concessões - Pessoas físicas - Financiamento com recursos do BNDES total - Recursos direcionados", "Concessões - Pessoas físicas - Microcrédito destinado a consumo - Recursos direcionados", "Concessões - Pessoas físicas - Microcrédito destinado a microempreendedores - Recursos direcionados", "Concessões - Pessoas físicas - Microcrédito total - Recursos direcionados", "Concessões - Pessoas físicas - Outros créditos direcionados - Recursos direcionados")

write.csv2(base1,"01-Séries concessões.csv", row.names = F)
export(base1, "Concessões totais(fonte).xlsx", sheetName = "01-Séries concessões")

#Calculo de série por dia útil
url_ipea="http://www.ipeadata.gov.br/ExibeSerie.aspx?serid=459044792"
ipea.table1 = readHTMLTable(htmlParse(getURL(url_ipea, useragent="curl/7.39.0 Rcurl/1.95.4.5")), header=T, which=3,stringsAsFactors=F)
ipea.table1 = ipea.table1[-1:-4,-3]
names(ipea.table1) = c("Data", "Dias úteis")
ipea.table1 = ipea.table1[rowSums(is.na(ipea.table1)) == 0,]
ipea.table1 = ipea.table1[-dim(ipea.table1)[1],]
ipea.table1 = ipea.table1[-dim(ipea.table1)[1],]
dias_uteis= ipea.table1[which(ipea.table1$Data=="2011.03"):which(ipea.table1$Data==format(as.Date(tail(base1$Data,1)),"%Y.%m")),]

base2 = base1

base2=apply(base2[,2:85],2,function(x){base2=x/as.numeric(dias_uteis[,2]);return(base2)})
base2 = as.data.frame(base2)
base2 = cbind(base1[,1], base2)

names(base2)=c("Data","Concessões diárias - Total", "Concessões diárias - Pessoas jurídicas - Total", "Concessões diárias - Pessoas físicas - Total", 
               "Concessões diárias - Total - Recursos livres", "Concessões diárias - Pessoas jurídicas - Total - Recursos livres", "Concessões diárias - Pessoas jurídicas - Não rotativo - Recursos livres", "Concessões diárias - Pessoas jurídicas - Rotativo - Recursos livres", "Concessões diárias - Pessoas jurídicas - Desconto de duplicatas e recebíveis - Recursos livres", "Concessões diárias - Pessoas jurídicas - Desconto de cheques - Recursos livres", "Concessões diárias - Pessoas jurídicas - Antecipação de faturas de cartão de crédito - Recursos livres", "Concessões diárias - Pessoas jurídicas - Capital de giro com prazo de até 365 dias - Recursos livres", "Concessões diárias - Pessoas jurídicas - Capital de giro com prazo superior a 365 dias - Recursos livres", "Concessões diárias - Pessoas jurídicas - Capital de giro rotativo - Recursos livres", "Concessões diárias - Pessoas jurídicas - Capital de giro total - Recursos livres", "Concessões diárias - Pessoas jurídicas - Conta garantida - Recursos livres", "Concessões diárias - Pessoas jurídicas - Cheque especial - Recursos livres", "Concessões diárias - Pessoas jurídicas - Aquisição de veículos - Recursos livres", "Concessões diárias - Pessoas jurídicas - Aquisição de outros bens - Recursos livres", "Concessões diárias - Pessoas jurídicas - Aquisição de bens total - Recursos livres", "Concessões diárias - Pessoas jurídicas - Arrendamento mercantil de veículos - Recursos livres", "Concessões diárias - Pessoas jurídicas - Arrendamento mercantil de outros bens - Recursos livres", "Concessões diárias - Pessoas jurídicas - Arrendamento mercantil total - Recursos livres", "Concessões diárias - Pessoas jurídicas - Vendor - Recursos livres", "Concessões diárias - Pessoas jurídicas - Compror - Recursos livres", "Concessões diárias - Pessoas jurídicas - Cartão de crédito rotativo - Recursos livres", "Concessões diárias - Pessoas jurídicas - Cartão de crédito parcelado - Recursos livres", "Concessões diárias - Pessoas jurídicas - Cartão de crédito à vista - Recursos livres",
               "Concessões diárias - Pessoas jurídicas - Cartão de crédito total - Recursos livres", "Concessões diárias - Pessoas jurídicas - Adiantamento sobre contratos de câmbio (ACC) - Recursos livres", "Concessões diárias - Pessoas jurídicas - Financiamento a importações - Recursos livres", "Concessões diárias - Pessoas jurídicas - Financiamento a exportações - Recursos livres", "Concessões diárias - Pessoas jurídicas - Repasse externo - Recursos livres", "Concessões diárias - Pessoas jurídicas - Outros créditos livres - Recursos livres", "Concessões diárias - Pessoas físicas - Total - Recursos livres", "Concessões diárias - Pessoas físicas - Não rotativo - Recursos livres", "Concessões diárias - Pessoas físicas - Rotativo - Recursos livres", "Concessões diárias - Pessoas físicas - Cheque especial - Recursos livres", "Concessões diárias - Pessoas físicas - Crédito pessoal não consignado - Recursos livres", "Concessões diárias - Pessoas físicas - Crédito pessoal não consignado vinculado à composição de dívidas - Recursos livres", "Concessões diárias - Pessoas físicas - Crédito pessoal consignado para trabalhadores do setor privado - Recursos livres", "Concessões diárias - Pessoas físicas - Crédito pessoal consignado para trabalhadores do setor público - Recursos livres", "Concessões diárias - Pessoas físicas - Crédito pessoal consignado para aposentados e pensionistas do INSS - Recursos livres", "Concessões diárias - Pessoas físicas - Crédito pessoal consignado total - Recursos livres", "Concessões diárias - Pessoas físicas - Crédito pessoal total - Recursos livres", "Concessões diárias - Pessoas físicas - Aquisição de veículos - Recursos livres", "Concessões diárias - Pessoas físicas - Aquisição de outros bens - Recursos livres", "Concessões diárias - Pessoas físicas - Aquisição de bens total - Recursos livres", "Concessões diárias - Pessoas físicas - Arrendamento mercantil de veículos - Recursos livres", "Concessões diárias - Pessoas físicas - Arrendamento mercantil de outros bens - Recursos livres", "Concessões diárias - Pessoas físicas - Arrendamento mercantil total - Recursos livres", "Concessões diárias - Pessoas físicas - Cartão de crédito rotativo - Recursos livres", "Concessões diárias - Pessoas físicas - Cartão de crédito parcelado - Recursos livres", "Concessões diárias - Pessoas físicas - Cartão de crédito à vista - Recursos livres", "Concessões diárias - Pessoas físicas - Cartão de crédito total - Recursos livres", "Concessões diárias - Pessoas físicas - Desconto de cheques - Recursos livres", "Concessões diárias - Pessoas físicas - Outros créditos livres - Recursos livres", 
               "Concessões diárias - Total - Recursos direcionados", "Concessões diárias - Pessoas jurídicas - Total - Recursos direcionados", "Concessões diárias - Pessoas jurídicas - Crédito rural com taxas de mercado - Recursos direcionados", "Concessões diárias - Pessoas jurídicas - Crédito rural com taxas reguladas - Recursos direcionados", "Concessões diárias - Pessoas jurídicas - Crédito rural total - Recursos direcionados", "Concessões diárias - Pessoas jurídicas - Financiamento imobiliário com taxas de mercado - Recursos direcionados", "Concessões diárias - Pessoas jurídicas - Financiamento imobiliário com taxas reguladas - Recursos direcionados", "Concessões diárias - Pessoas jurídicas - Financiamento imobiliário total - Recursos direcionados", "Concessões diárias - Pessoas jurídicas - Capital de giro com recursos do BNDES - Recursos direcionados", "Concessões diárias - Pessoas jurídicas - Financiamento de investimentos com recursos do BNDES - Recursos direcionados", "Concessões diárias - Pessoas jurídicas - Financiamento agroindustrial com recursos do BNDES - Recursos direcionados", "Concessões diárias - Pessoas jurídicas - Financiamento com recursos do BNDES total - Recursos direcionados", "Concessões diárias - Pessoas jurídicas - Outros créditos direcionados - Recursos direcionados", "Concessões diárias - Pessoas físicas - Total - Recursos direcionados", "Concessões diárias - Pessoas físicas - Crédito rural com taxas de mercado - Recursos direcionados", "Concessões diárias - Pessoas físicas - Crédito rural com taxas reguladas - Recursos direcionados", "Concessões diárias - Pessoas físicas - Crédito rural total - Recursos direcionados", "Concessões diárias - Pessoas físicas - Financiamento imobiliário com taxas de mercado - Recursos direcionados", "Concessões diárias - Pessoas físicas - Financiamento imobiliário com taxas reguladas - Recursos direcionados", "Concessões diárias - Pessoas físicas - Financiamento imobiliário total - Recursos direcionados", "Concessões diárias - Pessoas físicas - Capital de giro com recursos do BNDES - Recursos direcionados", "Concessões diárias - Pessoas físicas - Financiamento de investimentos com recursos do BNDES - Recursos direcionados", "Concessões diárias - Pessoas físicas - Financiamento agroindustrial com recursos do BNDES - Recursos direcionados", "Concessões diárias - Pessoas físicas - Financiamento com recursos do BNDES total - Recursos direcionados", "Concessões diárias - Pessoas físicas - Microcrédito destinado a consumo - Recursos direcionados", "Concessões diárias - Pessoas físicas - Microcrédito destinado a microempreendedores - Recursos direcionados", "Concessões diárias - Pessoas físicas - Microcrédito total - Recursos direcionados", "Concessões diárias - Pessoas físicas - Outros créditos direcionados - Recursos direcionados")

write.csv2(base2,"02-Concessões diárias.csv", row.names = F)
export(base2, "Concessões totais(fonte).xlsx", which = "02-Concessões diárias")

#Calculo de deflacionamento
base3 = base2
base3[,-1]=apply(base3[,-1],2,function(x)as.numeric(gsub(",",".",x)))

url_ipea="http://www.ipeadata.gov.br/ExibeSerie.aspx?serid=36482"
ipea.table = readHTMLTable(htmlParse(getURL(url_ipea, useragent="curl/7.39.0 Rcurl/1.95.4.5")), header=T, which=3,stringsAsFactors=F)
ipea.table = ipea.table[-1:-4,-3]
names(ipea.table) = c("Data", "IPCA")
ipea.table = ipea.table[rowSums(is.na(ipea.table)) == 0,]
ipea.table = ipea.table[-dim(ipea.table)[1],]
ipea.table = ipea.table[-dim(ipea.table)[1],]
deflator = ipea.table[which(ipea.table$Data=="2011.03"):which(ipea.table$Data==format(as.Date(tail(base1$Data,1)),"%Y.%m")),]
deflator = as.numeric(gsub(",","\\.",gsub("\\.","",deflator[,2])))

base3=apply(base3[,2:85],2,function(x) (x/deflator)*tail(deflator,1))
base3 = as.data.frame(base3)
base3 = cbind(base1[,1], base3)

names(base3)=c("Data","Concessões deflacionadas - Total", "Concessões deflacionadas - Pessoas jurídicas - Total", "Concessões deflacionadas - Pessoas físicas - Total", 
               "Concessões deflacionadas - Total - Recursos livres", "Concessões deflacionadas - Pessoas jurídicas - Total - Recursos livres", "Concessões deflacionadas - Pessoas jurídicas - Não rotativo - Recursos livres", "Concessões deflacionadas - Pessoas jurídicas - Rotativo - Recursos livres", "Concessões deflacionadas - Pessoas jurídicas - Desconto de duplicatas e recebíveis - Recursos livres", "Concessões deflacionadas - Pessoas jurídicas - Desconto de cheques - Recursos livres", "Concessões deflacionadas - Pessoas jurídicas - Antecipação de faturas de cartão de crédito - Recursos livres", "Concessões deflacionadas - Pessoas jurídicas - Capital de giro com prazo de até 365 dias - Recursos livres", "Concessões deflacionadas - Pessoas jurídicas - Capital de giro com prazo superior a 365 dias - Recursos livres", "Concessões deflacionadas - Pessoas jurídicas - Capital de giro rotativo - Recursos livres", "Concessões deflacionadas - Pessoas jurídicas - Capital de giro total - Recursos livres", "Concessões deflacionadas - Pessoas jurídicas - Conta garantida - Recursos livres", "Concessões deflacionadas - Pessoas jurídicas - Cheque especial - Recursos livres", "Concessões deflacionadas - Pessoas jurídicas - Aquisição de veículos - Recursos livres", "Concessões deflacionadas - Pessoas jurídicas - Aquisição de outros bens - Recursos livres", "Concessões deflacionadas - Pessoas jurídicas - Aquisição de bens total - Recursos livres", "Concessões deflacionadas - Pessoas jurídicas - Arrendamento mercantil de veículos - Recursos livres", "Concessões deflacionadas - Pessoas jurídicas - Arrendamento mercantil de outros bens - Recursos livres", "Concessões deflacionadas - Pessoas jurídicas - Arrendamento mercantil total - Recursos livres", "Concessões deflacionadas - Pessoas jurídicas - Vendor - Recursos livres", "Concessões deflacionadas - Pessoas jurídicas - Compror - Recursos livres", "Concessões deflacionadas - Pessoas jurídicas - Cartão de crédito rotativo - Recursos livres", "Concessões deflacionadas - Pessoas jurídicas - Cartão de crédito parcelado - Recursos livres", "Concessões deflacionadas - Pessoas jurídicas - Cartão de crédito à vista - Recursos livres",
               "Concessões deflacionadas - Pessoas jurídicas - Cartão de crédito total - Recursos livres", "Concessões deflacionadas - Pessoas jurídicas - Adiantamento sobre contratos de câmbio (ACC) - Recursos livres", "Concessões deflacionadas - Pessoas jurídicas - Financiamento a importações - Recursos livres", "Concessões deflacionadas - Pessoas jurídicas - Financiamento a exportações - Recursos livres", "Concessões deflacionadas - Pessoas jurídicas - Repasse externo - Recursos livres", "Concessões deflacionadas - Pessoas jurídicas - Outros créditos livres - Recursos livres", "Concessões deflacionadas - Pessoas físicas - Total - Recursos livres", "Concessões deflacionadas - Pessoas físicas - Não rotativo - Recursos livres", "Concessões deflacionadas - Pessoas físicas - Rotativo - Recursos livres", "Concessões deflacionadas - Pessoas físicas - Cheque especial - Recursos livres", "Concessões deflacionadas - Pessoas físicas - Crédito pessoal não consignado - Recursos livres", "Concessões deflacionadas - Pessoas físicas - Crédito pessoal não consignado vinculado à composição de dívidas - Recursos livres", "Concessões deflacionadas - Pessoas físicas - Crédito pessoal consignado para trabalhadores do setor privado - Recursos livres", "Concessões deflacionadas - Pessoas físicas - Crédito pessoal consignado para trabalhadores do setor público - Recursos livres", "Concessões deflacionadas - Pessoas físicas - Crédito pessoal consignado para aposentados e pensionistas do INSS - Recursos livres", "Concessões deflacionadas - Pessoas físicas - Crédito pessoal consignado total - Recursos livres", "Concessões deflacionadas - Pessoas físicas - Crédito pessoal total - Recursos livres", "Concessões deflacionadas - Pessoas físicas - Aquisição de veículos - Recursos livres", "Concessões deflacionadas - Pessoas físicas - Aquisição de outros bens - Recursos livres", "Concessões deflacionadas - Pessoas físicas - Aquisição de bens total - Recursos livres", "Concessões deflacionadas - Pessoas físicas - Arrendamento mercantil de veículos - Recursos livres", "Concessões deflacionadas - Pessoas físicas - Arrendamento mercantil de outros bens - Recursos livres", "Concessões deflacionadas - Pessoas físicas - Arrendamento mercantil total - Recursos livres", "Concessões deflacionadas - Pessoas físicas - Cartão de crédito rotativo - Recursos livres", "Concessões deflacionadas - Pessoas físicas - Cartão de crédito parcelado - Recursos livres", "Concessões deflacionadas - Pessoas físicas - Cartão de crédito à vista - Recursos livres", "Concessões deflacionadas - Pessoas físicas - Cartão de crédito total - Recursos livres", "Concessões deflacionadas - Pessoas físicas - Desconto de cheques - Recursos livres", "Concessões deflacionadas - Pessoas físicas - Outros créditos livres - Recursos livres", 
               "Concessões deflacionadas - Total - Recursos direcionados", "Concessões deflacionadas - Pessoas jurídicas - Total - Recursos direcionados", "Concessões deflacionadas - Pessoas jurídicas - Crédito rural com taxas de mercado - Recursos direcionados", "Concessões deflacionadas - Pessoas jurídicas - Crédito rural com taxas reguladas - Recursos direcionados", "Concessões deflacionadas - Pessoas jurídicas - Crédito rural total - Recursos direcionados", "Concessões deflacionadas - Pessoas jurídicas - Financiamento imobiliário com taxas de mercado - Recursos direcionados", "Concessões deflacionadas - Pessoas jurídicas - Financiamento imobiliário com taxas reguladas - Recursos direcionados", "Concessões deflacionadas - Pessoas jurídicas - Financiamento imobiliário total - Recursos direcionados", "Concessões deflacionadas - Pessoas jurídicas - Capital de giro com recursos do BNDES - Recursos direcionados", "Concessões deflacionadas - Pessoas jurídicas - Financiamento de investimentos com recursos do BNDES - Recursos direcionados", "Concessões deflacionadas - Pessoas jurídicas - Financiamento agroindustrial com recursos do BNDES - Recursos direcionados", "Concessões deflacionadas - Pessoas jurídicas - Financiamento com recursos do BNDES total - Recursos direcionados", "Concessões deflacionadas - Pessoas jurídicas - Outros créditos direcionados - Recursos direcionados", "Concessões deflacionadas - Pessoas físicas - Total - Recursos direcionados", "Concessões deflacionadas - Pessoas físicas - Crédito rural com taxas de mercado - Recursos direcionados", "Concessões deflacionadas - Pessoas físicas - Crédito rural com taxas reguladas - Recursos direcionados", "Concessões deflacionadas - Pessoas físicas - Crédito rural total - Recursos direcionados", "Concessões deflacionadas - Pessoas físicas - Financiamento imobiliário com taxas de mercado - Recursos direcionados", "Concessões deflacionadas - Pessoas físicas - Financiamento imobiliário com taxas reguladas - Recursos direcionados", "Concessões deflacionadas - Pessoas físicas - Financiamento imobiliário total - Recursos direcionados", "Concessões deflacionadas - Pessoas físicas - Capital de giro com recursos do BNDES - Recursos direcionados", "Concessões deflacionadas - Pessoas físicas - Financiamento de investimentos com recursos do BNDES - Recursos direcionados", "Concessões deflacionadas - Pessoas físicas - Financiamento agroindustrial com recursos do BNDES - Recursos direcionados", "Concessões deflacionadas - Pessoas físicas - Financiamento com recursos do BNDES total - Recursos direcionados", "Concessões deflacionadas - Pessoas físicas - Microcrédito destinado a consumo - Recursos direcionados", "Concessões deflacionadas - Pessoas físicas - Microcrédito destinado a microempreendedores - Recursos direcionados", "Concessões deflacionadas - Pessoas físicas - Microcrédito total - Recursos direcionados", "Concessões deflacionadas - Pessoas físicas - Outros créditos direcionados - Recursos direcionados")

write.csv2(base3,"03-Concessões deflacionadas.csv", row.names = F)
export(base3, "Concessões totais(fonte).xlsx", which = "03-Concessões deflacionadas")

#Calculo de variação em 12 meses
recursos=apply(base3[,2:85],2,function(x){
  recursos1=rep(NA,12)
  for(i in 13:dim(base2)[1]) recursos1[i]=((x[i]/x[i-12])-1)*100
  return(recursos1)
})

base4 = as.data.frame(recursos)
base4 = cbind(base1[,1], base4)

names(base4)=c("Data","Concessões variação 12 meses - Total", "Concessões variação 12 meses - Pessoas jurídicas - Total", "Concessões variação 12 meses - Pessoas físicas - Total", 
               "Concessões variação 12 meses - Total - Recursos livres", "Concessões variação 12 meses - Pessoas jurídicas - Total - Recursos livres", "Concessões variação 12 meses - Pessoas jurídicas - Não rotativo - Recursos livres", "Concessões variação 12 meses - Pessoas jurídicas - Rotativo - Recursos livres", "Concessões variação 12 meses - Pessoas jurídicas - Desconto de duplicatas e recebíveis - Recursos livres", "Concessões variação 12 meses - Pessoas jurídicas - Desconto de cheques - Recursos livres", "Concessões variação 12 meses - Pessoas jurídicas - Antecipação de faturas de cartão de crédito - Recursos livres", "Concessões variação 12 meses - Pessoas jurídicas - Capital de giro com prazo de até 365 dias - Recursos livres", "Concessões variação 12 meses - Pessoas jurídicas - Capital de giro com prazo superior a 365 dias - Recursos livres", "Concessões variação 12 meses - Pessoas jurídicas - Capital de giro rotativo - Recursos livres", "Concessões variação 12 meses - Pessoas jurídicas - Capital de giro total - Recursos livres", "Concessões variação 12 meses - Pessoas jurídicas - Conta garantida - Recursos livres", "Concessões variação 12 meses - Pessoas jurídicas - Cheque especial - Recursos livres", "Concessões variação 12 meses - Pessoas jurídicas - Aquisição de veículos - Recursos livres", "Concessões variação 12 meses - Pessoas jurídicas - Aquisição de outros bens - Recursos livres", "Concessões variação 12 meses - Pessoas jurídicas - Aquisição de bens total - Recursos livres", "Concessões variação 12 meses - Pessoas jurídicas - Arrendamento mercantil de veículos - Recursos livres", "Concessões variação 12 meses - Pessoas jurídicas - Arrendamento mercantil de outros bens - Recursos livres", "Concessões variação 12 meses - Pessoas jurídicas - Arrendamento mercantil total - Recursos livres", "Concessões variação 12 meses - Pessoas jurídicas - Vendor - Recursos livres", "Concessões variação 12 meses - Pessoas jurídicas - Compror - Recursos livres", "Concessões variação 12 meses - Pessoas jurídicas - Cartão de crédito rotativo - Recursos livres", "Concessões variação 12 meses - Pessoas jurídicas - Cartão de crédito parcelado - Recursos livres", "Concessões variação 12 meses - Pessoas jurídicas - Cartão de crédito à vista - Recursos livres",
               "Concessões variação 12 meses - Pessoas jurídicas - Cartão de crédito total - Recursos livres", "Concessões variação 12 meses - Pessoas jurídicas - Adiantamento sobre contratos de câmbio (ACC) - Recursos livres", "Concessões variação 12 meses - Pessoas jurídicas - Financiamento a importações - Recursos livres", "Concessões variação 12 meses - Pessoas jurídicas - Financiamento a exportações - Recursos livres", "Concessões variação 12 meses - Pessoas jurídicas - Repasse externo - Recursos livres", "Concessões variação 12 meses - Pessoas jurídicas - Outros créditos livres - Recursos livres", "Concessões variação 12 meses - Pessoas físicas - Total - Recursos livres", "Concessões variação 12 meses - Pessoas físicas - Não rotativo - Recursos livres", "Concessões variação 12 meses - Pessoas físicas - Rotativo - Recursos livres", "Concessões variação 12 meses - Pessoas físicas - Cheque especial - Recursos livres", "Concessões variação 12 meses - Pessoas físicas - Crédito pessoal não consignado - Recursos livres", "Concessões variação 12 meses - Pessoas físicas - Crédito pessoal não consignado vinculado à composição de dívidas - Recursos livres", "Concessões variação 12 meses - Pessoas físicas - Crédito pessoal consignado para trabalhadores do setor privado - Recursos livres", "Concessões variação 12 meses - Pessoas físicas - Crédito pessoal consignado para trabalhadores do setor público - Recursos livres", "Concessões variação 12 meses - Pessoas físicas - Crédito pessoal consignado para aposentados e pensionistas do INSS - Recursos livres", "Concessões variação 12 meses - Pessoas físicas - Crédito pessoal consignado total - Recursos livres", "Concessões variação 12 meses - Pessoas físicas - Crédito pessoal total - Recursos livres", "Concessões variação 12 meses - Pessoas físicas - Aquisição de veículos - Recursos livres", "Concessões variação 12 meses - Pessoas físicas - Aquisição de outros bens - Recursos livres", "Concessões variação 12 meses - Pessoas físicas - Aquisição de bens total - Recursos livres", "Concessões variação 12 meses - Pessoas físicas - Arrendamento mercantil de veículos - Recursos livres", "Concessões variação 12 meses - Pessoas físicas - Arrendamento mercantil de outros bens - Recursos livres", "Concessões variação 12 meses - Pessoas físicas - Arrendamento mercantil total - Recursos livres", "Concessões variação 12 meses - Pessoas físicas - Cartão de crédito rotativo - Recursos livres", "Concessões variação 12 meses - Pessoas físicas - Cartão de crédito parcelado - Recursos livres", "Concessões variação 12 meses - Pessoas físicas - Cartão de crédito à vista - Recursos livres", "Concessões variação 12 meses - Pessoas físicas - Cartão de crédito total - Recursos livres", "Concessões variação 12 meses - Pessoas físicas - Desconto de cheques - Recursos livres", "Concessões variação 12 meses - Pessoas físicas - Outros créditos livres - Recursos livres", 
               "Concessões variação 12 meses - Total - Recursos direcionados", "Concessões variação 12 meses - Pessoas jurídicas - Total - Recursos direcionados", "Concessões variação 12 meses - Pessoas jurídicas - Crédito rural com taxas de mercado - Recursos direcionados", "Concessões variação 12 meses - Pessoas jurídicas - Crédito rural com taxas reguladas - Recursos direcionados", "Concessões variação 12 meses - Pessoas jurídicas - Crédito rural total - Recursos direcionados", "Concessões variação 12 meses - Pessoas jurídicas - Financiamento imobiliário com taxas de mercado - Recursos direcionados", "Concessões variação 12 meses - Pessoas jurídicas - Financiamento imobiliário com taxas reguladas - Recursos direcionados", "Concessões variação 12 meses - Pessoas jurídicas - Financiamento imobiliário total - Recursos direcionados", "Concessões variação 12 meses - Pessoas jurídicas - Capital de giro com recursos do BNDES - Recursos direcionados", "Concessões variação 12 meses - Pessoas jurídicas - Financiamento de investimentos com recursos do BNDES - Recursos direcionados", "Concessões variação 12 meses - Pessoas jurídicas - Financiamento agroindustrial com recursos do BNDES - Recursos direcionados", "Concessões variação 12 meses - Pessoas jurídicas - Financiamento com recursos do BNDES total - Recursos direcionados", "Concessões variação 12 meses - Pessoas jurídicas - Outros créditos direcionados - Recursos direcionados", "Concessões variação 12 meses - Pessoas físicas - Total - Recursos direcionados", "Concessões variação 12 meses - Pessoas físicas - Crédito rural com taxas de mercado - Recursos direcionados", "Concessões variação 12 meses - Pessoas físicas - Crédito rural com taxas reguladas - Recursos direcionados", "Concessões variação 12 meses - Pessoas físicas - Crédito rural total - Recursos direcionados", "Concessões variação 12 meses - Pessoas físicas - Financiamento imobiliário com taxas de mercado - Recursos direcionados", "Concessões variação 12 meses - Pessoas físicas - Financiamento imobiliário com taxas reguladas - Recursos direcionados", "Concessões variação 12 meses - Pessoas físicas - Financiamento imobiliário total - Recursos direcionados", "Concessões variação 12 meses - Pessoas físicas - Capital de giro com recursos do BNDES - Recursos direcionados", "Concessões variação 12 meses - Pessoas físicas - Financiamento de investimentos com recursos do BNDES - Recursos direcionados", "Concessões variação 12 meses - Pessoas físicas - Financiamento agroindustrial com recursos do BNDES - Recursos direcionados", "Concessões variação 12 meses - Pessoas físicas - Financiamento com recursos do BNDES total - Recursos direcionados", "Concessões variação 12 meses - Pessoas físicas - Microcrédito destinado a consumo - Recursos direcionados", "Concessões variação 12 meses - Pessoas físicas - Microcrédito destinado a microempreendedores - Recursos direcionados", "Concessões variação 12 meses - Pessoas físicas - Microcrédito total - Recursos direcionados", "Concessões variação 12 meses - Pessoas físicas - Outros créditos direcionados - Recursos direcionados")

write.csv2(base4,"04-Concessões variação 12 meses.csv", row.names = F)
export(base4, "Concessões totais(fonte).xlsx", which = "04-Concessões variação 12 meses")